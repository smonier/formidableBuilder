(self.webpackChunkformidableBuilder=self.webpackChunkformidableBuilder||[]).push([[624],{267:(e,t,n)=>{(t=n(314)(!1)).push([e.id,".fb-list{display:flex;flex-direction:column;align-items:center;gap:40px;padding:48px 64px 64px;background:linear-gradient(135deg, #f8faff 0%, #f1f5ff 80%);min-height:calc(100vh - 150px)}.fb-list__section{width:100%;max-width:1280px}.fb-panel{padding:32px 36px;border-radius:12px;box-shadow:0 20px 40px rgba(15,19,39,.08);display:flex;flex-direction:column;gap:24px}.fb-panel__header{display:flex;flex-direction:column;gap:8px}.fb-panel__body{display:flex;flex-direction:column;gap:20px}.fb-field{display:flex;flex-direction:column;gap:10px}.fb-textarea{width:100%;border:1px solid #cfd5e6;border-radius:8px;padding:12px;background:#fdfdff;resize:vertical;font-family:inherit}.fb-panel__actions{display:flex;justify-content:flex-end;gap:16px;padding-top:8px}.fb-list__loading,.fb-list__empty{display:flex;align-items:center;gap:12px;min-height:160px;justify-content:center}.fb-list__panel{padding:40px 48px;background:#fff;border-radius:16px;box-shadow:0 24px 60px rgba(19,32,68,.08);display:flex;flex-direction:column;gap:32px}.fb-card-grid{display:grid;grid-template-columns:1fr;gap:32px;width:100%}.fb-card{display:flex;flex-direction:column;gap:20px;padding:28px 32px;border-radius:20px;border:1px solid rgba(15,19,39,.08);box-shadow:0 20px 55px rgba(19,32,68,.08);background:#fdfdff}.fb-card__header{display:flex;align-items:flex-start;justify-content:space-between;gap:20px;padding-bottom:12px;border-bottom:1px solid rgba(143,155,179,.2)}.fb-card__title{display:flex;flex-direction:column;gap:4px}.fb-card__intro{min-height:64px;color:#31374a;line-height:1.5}.fb-card__intro-html{display:flex;flex-direction:column;gap:8px}.fb-card__intro-html p{margin:0}.fb-card__meta{display:flex;gap:32px;font-size:14px;color:#4c566a;border-top:1px solid rgba(143,155,179,.18);padding-top:16px}.fb-card__meta-item{display:flex;flex-direction:column;gap:6px}.fb-card__actions{display:flex;flex-direction:column;gap:12px;border-top:1px solid rgba(143,155,179,.15);padding-top:20px}.fb-card__actions-row{display:flex;flex-wrap:nowrap;gap:12px;width:100%}.fb-card__actions-row .moonstone-button{flex:1;justify-content:flex-start}@media(max-width: 900px){.fb-card__actions-row{flex-wrap:wrap}}@media(max-width: 1024px){.fb-list{padding:32px}.fb-list__panel{padding:32px}}@media(min-width: 720px){.fb-card-grid{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media(min-width: 1100px){.fb-card-grid{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media(max-width: 720px){.fb-list{padding:24px 16px 40px}.fb-card{padding:24px}}.fb-card-grid .moonstone-paper{margin-top:0}",""]),e.exports=t},268:(e,t,n)=>{var r=n(72),a=n(267);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.id,a,""]]);r(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},400:(e,t,n)=>{(t=n(314)(!1)).push([e.id,".fb-builder__wrapper{display:flex;flex-direction:column;gap:24px;padding:24px;background:linear-gradient(135deg, #f5f7ff 0%, #ffffff 60%)}.fb-toolbar{display:flex;align-items:center;gap:16px;padding:12px 16px;border-radius:16px;background:#fff;box-shadow:0 12px 30px rgba(15,19,39,.1)}.fb-back-button{width:48px;height:48px;border-radius:24px;border:1px solid rgba(0,0,0,.1);background:#fff;color:#000;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;line-height:0}.fb-back-button:hover{background:rgba(0,0,0,.06)}.fb-back-button svg{width:24px;height:24px}.fb-builder__content{display:grid;grid-template-columns:280px 1fr 340px;gap:24px}.fb-sidebar{padding:20px;border-radius:16px;background:#fff;box-shadow:0 20px 40px rgba(10,17,35,.08);display:flex;flex-direction:column;gap:16px}.fb-sidebar__header{display:flex;justify-content:space-between;align-items:center}.fb-step-list,.fb-field-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}.fb-step,.fb-field-row{border:1px solid rgba(0,0,0,0);border-radius:12px;background:#f7f8fc;display:flex;justify-content:space-between;align-items:center;padding:12px;transition:border .15s ease,box-shadow .15s ease,background .15s ease}.fb-step--active,.fb-field-row--active{border-color:#2681ff;background:#fff;box-shadow:0 10px 30px rgba(38,129,255,.2)}.fb-step__button,.fb-field-row__button{font:inherit;border:none;background:rgba(0,0,0,0);text-align:left;flex:1;cursor:pointer}.fb-step-editor,.fb-field-editor,.fb-json,.fb-field{display:flex;flex-direction:column;gap:8px}.moonstone-typography.moonstone-variant_subheading{margin-top:10px;margin-bottom:10px}.fb-step-editor{padding:28px;border-radius:18px;background:#fff;box-shadow:0 25px 50px rgba(18,28,78,.1)}.fb-step-editor__form,.fb-step-editor__actions,.fb-step-editor__list{display:flex;flex-direction:column;margin-top:20px;padding-top:12px;border-top:1px solid rgba(0,0,0,.05);gap:16px}.fb-field-editor__header{display:flex;align-items:center;justify-content:space-between}.fb-field-editor__type{color:#6c7283;text-transform:uppercase}.fb-field--inline{flex-direction:row;align-items:center;justify-content:space-between}.fb-field--divider{padding:12px 0;border-top:1px solid rgba(0,0,0,.05);border-bottom:1px solid hsla(0,0%,100%,.6)}.fb-option-section{background:#fff;border:1px solid rgba(0,0,0,.05);border-radius:14px;padding:16px;box-shadow:0 10px 25px rgba(10,17,35,.06)}.fb-option-section__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.fb-option-card-list{display:flex;flex-direction:column;gap:12px}.fb-option-card{border:1px solid rgba(0,0,0,.05);border-radius:12px;padding:12px;background:#fdfdff;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.6)}.fb-option-card__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.fb-option-card__grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px}.fb-textarea{width:100%;border:1px solid #cfd5e6;border-radius:10px;padding:12px 14px;background:#fbfcff;resize:vertical;font-family:inherit}.fb-field-type-grid{display:flex;flex-wrap:wrap;gap:8px}.fb-field-list{overflow-y:auto}.fb-builder__main{display:flex;flex-direction:column;gap:16px}.fb-builder__side{display:flex;flex-direction:column;gap:16px}.fb-json__code{font-family:monospace;background:#0b1a30;color:#9ef5ff;padding:16px;border-radius:12px;max-height:320px;overflow:auto}.fb-input{display:flex;flex-direction:column;gap:8px}.fb-input__control{border:1px solid #cfd5e6;border-radius:10px;padding:10px 12px}.fb-options{display:flex;flex-direction:column;gap:8px;margin:0;padding:0;list-style:none}.fb-option-row{display:flex;gap:8px;align-items:center}.fb-loading{display:flex;flex-direction:column;align-items:center;gap:12px;padding:64px}",""]),e.exports=t},619:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>yt});var r=n(119),a=n(255);const i="/form-builder";var l,o=n(633),d=n.n(o),s=n(556),u=n.n(s),p=n(82),c=n(338),f={"X-Requested-With":"XMLHttpRequest"},m=function(){var e,t;return l||(l=new c.ApolloClient({link:new c.HttpLink({uri:(e=window.contextJsParameters,t=(void 0===e?{}:e).contextPath,"".concat((void 0===t?"":t)||"","/modules/graphql")),credentials:"include",headers:f}),cache:new c.InMemoryCache({typePolicies:{JCRNode:{keyFields:["uuid"]}}}),connectToDevTools:!1})),l},b=n(10);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,b.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v="formidableBuilder",y="EDIT",x=function(e,t){return{name:e,type:"boolean",labelKey:t}},k=function(e,t){return h({name:e,type:"text",labelKey:t},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},E=function(e,t){return{name:e,type:"number",labelKey:t}},w=function(e,t){return{name:e,type:"date",labelKey:t}},S=function(e,t){return{name:e,type:"datetime",labelKey:t}},N=function(e,t,n,r){return{name:e,type:"select",labelKey:t,options:n,defaultValue:r}},T=function(e,t){return h({name:e,type:"stringList",labelKey:t},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},C=[{id:"inputButton",nodeType:"fmdb:inputButton",labelKey:"fields.types.inputButton",defaultProperties:{buttonType:"button",variant:"primary"},propertySchema:[N("buttonType","builder.fields.properties.buttonType",[{value:"button",labelKey:"builder.fields.properties.buttonTypeOptions.button"},{value:"submit",labelKey:"builder.fields.properties.buttonTypeOptions.submit"},{value:"reset",labelKey:"builder.fields.properties.buttonTypeOptions.reset"}],"button"),N("variant","builder.fields.properties.variant",[{value:"primary",labelKey:"builder.fields.properties.variantOptions.primary"},{value:"secondary",labelKey:"builder.fields.properties.variantOptions.secondary"},{value:"danger",labelKey:"builder.fields.properties.variantOptions.danger"}],"primary")]},{id:"inputCheckbox",nodeType:"fmdb:inputCheckbox",labelKey:"fields.types.inputCheckbox",defaultProperties:{required:!1,defaultChecked:!1,value:""},propertySchema:[x("required","builder.fields.properties.required"),x("defaultChecked","builder.fields.properties.defaultChecked"),k("value","builder.fields.properties.value")]},{id:"checkboxGroup",nodeType:"fmdb:checkboxGroup",labelKey:"fields.types.checkboxGroup",defaultProperties:{required:!1},propertySchema:[x("required","builder.fields.properties.required")]},{id:"inputColor",nodeType:"fmdb:inputColor",labelKey:"fields.types.inputColor",defaultProperties:{required:!1,defaultValue:""},propertySchema:[x("required","builder.fields.properties.required"),k("defaultValue","builder.fields.properties.defaultValue")]},{id:"inputDate",nodeType:"fmdb:inputDate",labelKey:"fields.types.inputDate",defaultProperties:{required:!1,defaultValue:null,min:null,max:null,step:null},propertySchema:[x("required","builder.fields.properties.required"),w("defaultValue","builder.fields.properties.defaultDate"),w("min","builder.fields.properties.minDate"),w("max","builder.fields.properties.maxDate"),E("step","builder.fields.properties.step")]},{id:"inputDatetimeLocal",nodeType:"fmdb:inputDatetimeLocal",labelKey:"fields.types.inputDatetimeLocal",defaultProperties:{required:!1,defaultValue:null,min:null,max:null,step:null},propertySchema:[x("required","builder.fields.properties.required"),S("defaultValue","builder.fields.properties.defaultDateTime"),S("min","builder.fields.properties.minDateTime"),S("max","builder.fields.properties.maxDateTime"),E("step","builder.fields.properties.step")]},{id:"inputEmail",nodeType:"fmdb:inputEmail",labelKey:"fields.types.inputEmail",defaultProperties:{required:!1,autocomplete:!1,multiple:!1,placeholder:"",defaultValue:"",list:[],pattern:"",minLength:null,maxLength:null},propertySchema:[x("required","builder.fields.properties.required"),x("autocomplete","builder.fields.properties.autocomplete"),x("multiple","builder.fields.properties.multiple"),k("placeholder","builder.fields.properties.placeholder"),k("defaultValue","builder.fields.properties.defaultValue"),T("list","builder.fields.properties.list",{addLabelKey:"builder.fields.properties.listAdd",removeLabelKey:"builder.fields.properties.listRemove",itemLabelKey:"builder.fields.properties.listItem"}),k("pattern","builder.fields.properties.pattern"),E("minLength","builder.fields.properties.minLength"),E("maxLength","builder.fields.properties.maxLength")]},{id:"inputFile",nodeType:"fmdb:inputFile",labelKey:"fields.types.inputFile",defaultProperties:{accept:"",multiple:!1,required:!1},propertySchema:[k("accept","builder.fields.properties.accept"),x("multiple","builder.fields.properties.multiple"),x("required","builder.fields.properties.required")]},{id:"inputHidden",nodeType:"fmdb:inputHidden",labelKey:"fields.types.inputHidden",defaultProperties:{value:""},propertySchema:[k("value","builder.fields.properties.value")]},{id:"inputRadio",nodeType:"fmdb:inputRadio",labelKey:"fields.types.inputRadio",allowedParents:["radioGroup"],defaultProperties:{defaultChecked:!1,value:""},propertySchema:[x("defaultChecked","builder.fields.properties.defaultChecked"),k("value","builder.fields.properties.value")]},{id:"radioGroup",nodeType:"fmdb:radioGroup",labelKey:"fields.types.radioGroup",defaultProperties:{required:!1},propertySchema:[x("required","builder.fields.properties.required")]},{id:"inputText",nodeType:"fmdb:inputText",labelKey:"fields.types.inputText",defaultProperties:{required:!1,placeholder:"",defaultValue:"",list:[],minLength:null,maxLength:null},propertySchema:[x("required","builder.fields.properties.required"),k("placeholder","builder.fields.properties.placeholder"),k("defaultValue","builder.fields.properties.defaultValue"),T("list","builder.fields.properties.list",{addLabelKey:"builder.fields.properties.listAdd",removeLabelKey:"builder.fields.properties.listRemove",itemLabelKey:"builder.fields.properties.listItem"}),E("minLength","builder.fields.properties.minLength"),E("maxLength","builder.fields.properties.maxLength")]},{id:"select",nodeType:"fmdb:select",labelKey:"fields.types.select",defaultProperties:{options:[{label:"Option 1",value:"option-1",selected:!1}],size:null,required:!1,multiple:!1,disabled:!1,autofocus:!1},propertySchema:[E("size","builder.fields.properties.size"),x("required","builder.fields.properties.required"),x("multiple","builder.fields.properties.multiple"),x("disabled","builder.fields.properties.disabled"),x("autofocus","builder.fields.properties.autofocus")]},{id:"textarea",nodeType:"fmdb:textarea",labelKey:"fields.types.textarea",defaultProperties:{required:!1,placeholder:"",defaultValue:"",minLength:null,maxLength:null,rows:null,resize:"vertical"},propertySchema:[x("required","builder.fields.properties.required"),k("placeholder","builder.fields.properties.placeholder"),{name:"defaultValue",type:"multiline",labelKey:"builder.fields.properties.defaultValue"},E("minLength","builder.fields.properties.minLength"),E("maxLength","builder.fields.properties.maxLength"),E("rows","builder.fields.properties.rows"),N("resize","builder.fields.properties.resize",[{value:"none",labelKey:"builder.fields.properties.resizeOptions.none"},{value:"both",labelKey:"builder.fields.properties.resizeOptions.both"},{value:"horizontal",labelKey:"builder.fields.properties.resizeOptions.horizontal"},{value:"vertical",labelKey:"builder.fields.properties.resizeOptions.vertical"}],"vertical")]}],A=function(e){return C.find(function(t){return t.nodeType===e})},O=function(e){return C.find(function(t){return t.id===e})},_=function(e,t){var n=O(e);if(!n)throw new Error("Unknown field type ".concat(e));return{id:"temp-".concat(Date.now()),label:t||"",name:"",description:"",type:n.id,nodeType:n.nodeType,properties:h({},n.defaultProperties)}},P=(0,o.createContext)(null),j=function(e){var t=e.children,n=window,r=n.contextJsParameters,a=void 0===r?{}:r,i=n.formidableBuilder,l=void 0===i?{}:i,s=a.lang,u=void 0===s?"en":s,p=a.siteKey,c=void 0===p?"default":p,f=a.language,b=void 0===f?a.lang:f,g=a.workspace,h=void 0===g?y:g,x=l.uiLanguage||u||b||"en",k=l.siteKey||c,E=l.formsPath||function(e){return"/sites/".concat(e,"/contents/forms")}(k),w=l.workspace||h||y,S=function(){var e=(w||y).toUpperCase();return"LIVE"===e||"EDIT"===e?e:y}(),N=(0,o.useMemo)(function(){return{client:m(),namespace:v,language:x,siteKey:k,workspace:S,formsPath:E}},[x,k,E,S]);return d().createElement(P.Provider,{value:N},t)};j.propTypes={children:u().node.isRequired};var I=function(){var e=(0,o.useContext)(P);if(!e)throw new Error("useFormBuilderContext must be used inside FormBuilderProvider");return e},R=n(816),F=n(207),L=n.n(F),$=n(107),q=n(658),D=n(285),B=n(648),K=["className"];function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach(function(t){(0,b.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var M={title:"",intro:""},V=function(e){var t=e.isOpen,n=e.onCancel,r=e.onSubmit,i=e.isLoading,l=(0,q.useTranslation)(v).t,s=(0,o.useState)(M),u=(0,a.A)(s,2),p=u[0],c=u[1],f=$.Textarea||function(e){var t=e.className,n=void 0===t?"":t,r=(0,B.A)(e,K);return d().createElement("textarea",(0,D.A)({className:"fb-textarea ".concat(n).trim()},r))};if((0,o.useEffect)(function(){t||c(M)},[t]),!t)return null;var m=function(e,t){c(function(n){return G(G({},n),{},(0,b.A)({},e,t))})},g=!p.title||i;return d().createElement($.Paper,{className:"fb-panel"},d().createElement("div",{className:"fb-panel__header"},d().createElement($.Typography,{variant:"heading"},l("list.create.title")),d().createElement($.Typography,{variant:"body"},l("list.create.description"))),d().createElement("div",{className:"fb-panel__body"},d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},l("list.fields.title")),d().createElement($.Input,{value:p.title,placeholder:l("list.fields.titlePlaceholder"),size:"big",onChange:function(e){return m("title",e.target.value)}})),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},l("list.fields.intro")),d().createElement(f,{value:p.intro,placeholder:l("list.fields.introPlaceholder"),rows:4,onChange:function(e){return m("intro",e.target.value)}}))),d().createElement("div",{className:"fb-panel__actions"},d().createElement($.Button,{label:l("actions.cancel"),size:"big",onClick:n}),d().createElement($.Button,{label:l(i?"actions.creating":"actions.create"),size:"big",color:"accent",isDisabled:g,onClick:function(){return r(p)}})))};V.propTypes={isOpen:u().bool.isRequired,onCancel:u().func.isRequired,onSubmit:u().func.isRequired,isLoading:u().bool},V.defaultProps={isLoading:!1};var J,W,H,U,Q,X,Y,Z,ee,te,ne,re,ae,ie,le,oe,de,se,ue=n(721),pe=(0,c.gql)(J||(J=(0,ue.A)(["\n    fragment PropertyFields on JCRProperty {\n        name\n        value\n        values\n        type\n    }\n"]))),ce=(0,c.gql)(W||(W=(0,ue.A)(["\n    fragment FieldChildFragment on JCRNode {\n        uuid\n        name\n        path\n        primaryNodeType {\n            name\n        }\n        displayName(language: $language)\n        properties(language: $language) {\n            ...PropertyFields\n        }\n    }\n    ","\n"])),pe),fe=(0,c.gql)(H||(H=(0,ue.A)(["\n    fragment FieldFragment on JCRNode {\n        uuid\n        name\n        path\n        primaryNodeType {\n            name\n        }\n        displayName(language: $language)\n        properties(language: $language) {\n            ...PropertyFields\n        }\n        children {\n            nodes {\n                ...FieldChildFragment\n            }\n        }\n    }\n    ","\n    ","\n"])),ce,pe),me=(0,c.gql)(U||(U=(0,ue.A)(['\n    fragment StepFragment on JCRNode {\n        uuid\n        name\n        path\n        primaryNodeType {\n            name\n        }\n        displayName(language: $language)\n        properties(language: $language, names: ["jcr:description"]) {\n            ...PropertyFields\n        }\n        children {\n            nodes {\n                ...FieldFragment\n            }\n        }\n    }\n    ',"\n    ","\n"])),fe,pe),be=(0,c.gql)(Q||(Q=(0,ue.A)(['\n    fragment FormFragment on JCRNode {\n        uuid\n        name\n        path\n        displayName(language: $language)\n        properties(language: $language, names: ["intro", "jcr:title"]) {\n            ...PropertyFields\n        }\n        children {\n            nodes {\n                ...StepFragment\n            }\n        }\n        fieldsetsContainers: children(names: ["fieldsets"]) {\n            nodes {\n                uuid\n                name\n                path\n                children {\n                    nodes {\n                        ...StepFragment\n                    }\n                }\n            }\n        }\n    }\n    ',"\n    ","\n"])),me,pe),ge=(0,c.gql)(X||(X=(0,ue.A)(['\n    query GetFormidableForms($workspace: Workspace!, $language: String!, $paths: [String!]!) {\n        jcr(workspace: $workspace) {\n            nodesByCriteria(criteria: {nodeType: "fmdb:form", paths: $paths}) {\n                nodes {\n                    uuid\n                    name\n                    path\n                    displayName(language: $language)\n                    properties(language: $language, names: ["intro", "jcr:lastModified"]) {\n                        ...PropertyFields\n                    }\n                    children(names: ["fieldsets"]) {\n                        nodes {\n                            children {\n                                nodes {\n                                    uuid\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    ',"\n"])),pe),he=(0,c.gql)(Y||(Y=(0,ue.A)(["\n    query GetFormidableForm($workspace: Workspace!, $language: String!, $uuid: String!) {\n        jcr(workspace: $workspace) {\n            nodeById(uuid: $uuid) {\n                ...FormFragment\n            }\n        }\n    }\n    ","\n"])),be),ve=(0,c.gql)(Z||(Z=(0,ue.A)(['\n    query GetSiteLanguages($workspace: Workspace!, $sitePath: String!) {\n        jcr(workspace: $workspace) {\n            nodeByPath(path: $sitePath) {\n                languages: property(name: "j:languages") {\n                    values\n                }\n            }\n        }\n    }\n']))),ye=(0,c.gql)(ee||(ee=(0,ue.A)(['\n    mutation CreateForm($workspace: Workspace!, $parentPath: String!, $name: String!, $language: String!, $title: String!, $intro: String) {\n        jcr(workspace: $workspace) {\n            addNode(\n                parentPathOrId: $parentPath\n                name: $name\n                primaryNodeType: "fmdb:form"\n                properties: [\n                    {name: "jcr:title", value: $title, language: $language}\n                    {name: "intro", value: $intro, language: $language}\n                ]\n            ) {\n                uuid\n            }\n        }\n    }\n']))),xe=(0,c.gql)(te||(te=(0,ue.A)(['\n    mutation UpdateFormMetadata($workspace: Workspace!, $pathOrId: String!, $language: String!, $title: String!, $intro: String) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                mutateProperty(name: "jcr:title") {\n                    setValue(value: $title, language: $language)\n                }\n                mutateProperty(name: "intro") {\n                    setValue(value: $intro, language: $language)\n                }\n                uuid\n            }\n        }\n    }\n']))),ke=(0,c.gql)(ne||(ne=(0,ue.A)(["\n    mutation DeleteNode($workspace: Workspace!, $pathOrId: String!) {\n        jcr(workspace: $workspace) {\n            deleteNode(pathOrId: $pathOrId)\n        }\n    }\n"]))),Ee=(0,c.gql)(re||(re=(0,ue.A)(['\n    mutation AddFieldset($workspace: Workspace!, $parentPath: String!, $name: String!, $language: String!, $title: String!, $description: String) {\n        jcr(workspace: $workspace) {\n            addNode(\n                parentPathOrId: $parentPath\n                name: $name\n                primaryNodeType: "fmdb:fieldset"\n                properties: [\n                    {name: "jcr:title", value: $title, language: $language}\n                    {name: "jcr:description", value: $description, language: $language}\n                ]\n            ) {\n                uuid\n            }\n        }\n    }\n']))),we=(0,c.gql)(ae||(ae=(0,ue.A)(["\n    mutation UpdateFieldset($workspace: Workspace!, $pathOrId: String!, $properties: [InputJCRProperty]!) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                setPropertiesBatch(properties: $properties) {\n                    property {\n                        name\n                    }\n                }\n                uuid\n            }\n        }\n    }\n"]))),Se=(0,c.gql)(ie||(ie=(0,ue.A)(["\n    mutation ReorderSteps($workspace: Workspace!, $pathOrId: String!, $names: [String!]!) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                reorderChildren(names: $names)\n            }\n        }\n    }\n"]))),Ne=(0,c.gql)(le||(le=(0,ue.A)(["\n    mutation AddField($workspace: Workspace!, $parentPath: String!, $name: String!, $primaryNodeType: String!, $properties: [InputJCRProperty]!) {\n        jcr(workspace: $workspace) {\n            addNode(\n                parentPathOrId: $parentPath\n                name: $name\n                primaryNodeType: $primaryNodeType\n                properties: $properties\n            ) {\n                uuid\n            }\n        }\n    }\n"]))),Te=(0,c.gql)(oe||(oe=(0,ue.A)(["\n    mutation UpdateField($workspace: Workspace!, $pathOrId: String!, $properties: [InputJCRProperty]!) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                setPropertiesBatch(properties: $properties) {\n                    property {\n                        name\n                    }\n                }\n                uuid\n            }\n        }\n    }\n"]))),Ce=(0,c.gql)(de||(de=(0,ue.A)(["\n    mutation ReorderFields($workspace: Workspace!, $pathOrId: String!, $names: [String!]!) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                reorderChildren(names: $names)\n            }\n        }\n    }\n"]))),Ae=(0,c.gql)(se||(se=(0,ue.A)(["\n    mutation RenameNode($workspace: Workspace!, $pathOrId: String!, $name: String!) {\n        jcr(workspace: $workspace) {\n            mutateNode(pathOrId: $pathOrId) {\n                rename(name: $name)\n                uuid\n            }\n        }\n    }\n"]))),Oe=function(e){return e?e.toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,42):""},_e=function(e){var t=((e.children||{}).nodes||[])[0];return(t&&(t.children||{}).nodes||[]).length},Pe=n(987),je=(n(268),function(){var e=(0,q.useTranslation)(v).t,t=(0,p.useHistory)(),n=(0,p.useRouteMatch)(),r=I().language,i=function(){var e=I(),t=e.workspace,n=e.language,r=e.formsPath,i=(0,c.useQuery)(ge,{variables:{workspace:t,language:n,paths:[r]},fetchPolicy:"network-only"}),l=i.data,d=i.loading,s=i.refetch,u=(0,c.useMutation)(ye),p=(0,a.A)(u,2),f=p[0],m=p[1].loading,b=(0,c.useMutation)(ke),g=(0,a.A)(b,2),h=g[0],v=g[1].loading,y=(0,o.useMemo)(function(){var e;return((null==l||null===(e=l.jcr)||void 0===e||null===(e=e.nodesByCriteria)||void 0===e?void 0:e.nodes)||[]).map(function(e){var t,n;return{id:e.uuid,name:e.name,path:e.path,title:e.displayName||e.name,intro:(null===(t=e.properties)||void 0===t||null===(t=t.find(function(e){return"intro"===e.name}))||void 0===t?void 0:t.value)||"",steps:_e(e),updatedAt:(null===(n=e.properties)||void 0===n||null===(n=n.find(function(e){return"jcr:lastModified"===e.name}))||void 0===n?void 0:n.value)||null}})},[l]),x=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(a){var i;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Oe(a.title)||"form-".concat(Date.now()),e.next=1,f({variables:{workspace:t,parentPath:r,name:i,language:n,title:a.title,intro:a.intro||""}});case 1:return e.next=2,s();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[f,r,n,s,t]),k=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(n){return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,h({variables:{workspace:t,pathOrId:n}});case 1:return e.next=2,s();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[h,s,t]);return{forms:y,loading:d||m||v,createForm:x,deleteForm:k,refetch:s}}(),l=i.forms,s=i.loading,u=i.createForm,f=i.deleteForm,m=i.refetch,b=(0,o.useState)(!1),g=(0,a.A)(b,2),h=g[0],y=g[1],x=((null==n?void 0:n.url)||"/form-builder").replace(/\*$/,""),k=function(){var t=(0,R.A)(L().mark(function t(n){return L().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.confirm(e("list.actions.deleteConfirm",{title:n.title}))){t.next=1;break}return t.abrupt("return");case 1:return t.next=2,f(n.path);case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),E=(0,o.useMemo)(function(){var t=null;try{t=new Intl.DateTimeFormat(r||"en",{dateStyle:"medium",timeStyle:"short"})}catch(e){console.warn("Unable to format date for locale",r,e)}return function(n){if(!n)return e("list.cards.neverUpdated");try{return t?t.format(new Date(n)):n}catch(e){return n}}},[r,e]),w=function(){var t=(0,R.A)(L().mark(function t(n){var r;return L().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e("list.cards.duplicateName",{title:n.title}),t.next=1,u({title:r,intro:n.intro});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();return d().createElement($.LayoutContent,{header:d().createElement($.Header,{title:e("list.title"),subtitle:e("list.subtitle"),mainActions:[d().createElement($.Button,{key:"refresh",size:"big",label:e("actions.refresh"),isDisabled:s,onClick:function(){return m()}}),d().createElement($.Button,{key:"createForm",color:"accent",size:"big",label:e("actions.create"),onClick:function(){return y(!0)}})]}),content:d().createElement("div",{className:"fb-list"},h&&d().createElement("div",{className:"fb-list__section"},d().createElement(V,{isOpen:h,isLoading:s,onCancel:function(){return y(!1)},onSubmit:function(){var e=(0,R.A)(L().mark(function e(t){return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,u(t);case 1:y(!1);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})),d().createElement($.Paper,{className:"fb-list__panel fb-list__section"},s&&d().createElement("div",{className:"fb-list__loading"},d().createElement($.Loader,{size:"big"}),d().createElement($.Typography,{variant:"body"},e("states.loading"))),!s&&0===l.length&&d().createElement("div",{className:"fb-list__empty"},d().createElement($.Typography,{variant:"body"},e("list.empty"))),!s&&l.length>0&&d().createElement("div",{className:"fb-card-grid"},l.map(function(n){return d().createElement($.Paper,{key:n.id,className:"fb-card"},d().createElement("div",{className:"fb-card__header"},d().createElement("div",{className:"fb-card__title"},d().createElement($.Typography,{variant:"subheading"},n.title),d().createElement($.Typography,{variant:"caption"},n.name)),d().createElement($.Chip,{color:"accent",size:"small",label:e("list.columns.stepCount",{count:n.steps})})),d().createElement("div",{className:"fb-card__intro"},n.intro?d().createElement("div",{dangerouslySetInnerHTML:{__html:n.intro},className:"fb-card__intro-html"}):d().createElement($.Typography,{variant:"body"},e("list.cards.introFallback"))),d().createElement("div",{className:"fb-card__meta"},d().createElement("div",{className:"fb-card__meta-item"},d().createElement($.Typography,{variant:"caption"},e("list.cards.updated")),d().createElement($.Typography,{variant:"body"},E(n.updatedAt)))),d().createElement("div",{className:"fb-card__actions"},[[{key:"preview",label:e("actions.preview"),onClick:function(){return function(e){t.push("".concat(x,"/").concat(e.id,"?view=preview"))}(n)},icon:Pe.cx},{key:"submissions",label:e("actions.submissions"),onClick:function(){return function(e){t.push("".concat(x,"/").concat(e.id,"?view=submissions"))}(n)},icon:Pe.cv},{key:"settings",label:e("actions.settings"),onClick:function(){return function(e){t.push("".concat(x,"/").concat(e.id,"?view=settings"))}(n)},icon:Pe.c1}],[{key:"duplicate",label:e("actions.duplicate"),onClick:function(){return w(n)},icon:Pe.a5},{key:"edit",label:e("actions.edit"),onClick:function(){return function(e){t.push({pathname:"".concat(x,"/").concat(e.id),state:{formTitle:e.title}})}(n)},icon:Pe.ai},{key:"delete",label:e("actions.delete"),onClick:function(){return k(n)},icon:Pe.aa,color:"danger"}]].map(function(e){return d().createElement("div",{key:"actions-row-".concat(e.map(function(e){return e.key}).join("-")),className:"fb-card__actions-row"},e.map(function(e){var t=e.icon;return d().createElement($.Button,{key:e.key,size:"default",variant:"ghost",color:e.color||"default",icon:d().createElement(t,{size:"small"}),label:e.label,onClick:e.onClick})}))})))}))))})}),Ie=n(375),Re=n(627),Fe=n(979),Le=function(e){var t=e.step,n=e.isActive,r=e.onSelect,a=e.onRemove,i=(0,q.useTranslation)(v).t,l=(0,Re.gl)({id:t.id}),o=l.attributes,s=l.listeners,u=l.setNodeRef,p=l.transform,c=l.transition,f={transform:Fe.Ks.Transform.toString(p),transition:c};return d().createElement("li",(0,D.A)({ref:u,style:f,className:"fb-step".concat(n?" fb-step--active":"")},o,s),d().createElement("button",{type:"button",className:"fb-step__button",onClick:function(){return r(t.id)}},d().createElement($.Typography,{variant:"body",weight:"bold"},t.label),d().createElement($.Typography,{variant:"caption"},t.fields.length," fields")),d().createElement($.Button,{label:i("builder.sidebar.removeStep"),className:"fb-step__delete",onClick:function(){return a(t.id)}}))};Le.propTypes={step:u().shape({id:u().string.isRequired,label:u().string.isRequired,fields:u().array}).isRequired,isActive:u().bool.isRequired,onSelect:u().func.isRequired,onRemove:u().func.isRequired};var $e=function(e){var t=e.steps,n=e.activeStepId,r=e.onSelectStep,a=e.onAddStep,i=e.onRemoveStep,l=e.onReorderSteps,o=(0,q.useTranslation)(v).t,s=(0,Ie.FR)((0,Ie.MS)(Ie.AN,{activationConstraint:{distance:8}}));return d().createElement($.Paper,{className:"fb-sidebar"},d().createElement("div",{className:"fb-sidebar__header"},d().createElement($.Typography,{variant:"subheading"},o("builder.sidebar.title")),d().createElement($.Button,{color:"accent",label:o("builder.sidebar.addStep"),onClick:a})),d().createElement(Ie.Mp,{sensors:s,onDragEnd:function(e){var n=e.active,r=e.over;if(r&&n.id!==r.id){var a=t.findIndex(function(e){return e.id===n.id}),i=t.findIndex(function(e){return e.id===r.id});if(-1!==a&&-1!==i){var o=(0,Re.be)(t,a,i);l(o)}}}},d().createElement(Re.gB,{items:t.map(function(e){return e.id}),strategy:Re._G},d().createElement("ul",{className:"fb-step-list"},t.map(function(e){return d().createElement(Le,{key:e.id,step:e,isActive:e.id===n,onSelect:r,onRemove:i})})))))};$e.propTypes={steps:u().array.isRequired,activeStepId:u().string,onSelectStep:u().func.isRequired,onAddStep:u().func.isRequired,onRemoveStep:u().func.isRequired,onReorderSteps:u().func.isRequired},$e.defaultProps={activeStepId:null};var qe=function(e){var t=e.field,n=e.isActive,r=e.onSelect,a=e.onRemove,i=(0,q.useTranslation)(v).t,l=(0,Re.gl)({id:t.id}),o=l.attributes,s=l.listeners,u=l.setNodeRef,p=l.transform,c=l.transition,f={transform:Fe.Ks.Transform.toString(p),transition:c};return d().createElement("li",(0,D.A)({ref:u,style:f,className:"fb-field-row".concat(n?" fb-field-row--active":"")},o,s),d().createElement("button",{type:"button",className:"fb-field-row__button",onClick:function(){return r(t.id)}},d().createElement($.Typography,{variant:"body",weight:"bold"},t.label||t.name),d().createElement($.Typography,{variant:"caption"},t.type)),d().createElement($.Button,{label:i("builder.fields.remove"),onClick:function(){return a(t.id)}}))};qe.propTypes={field:u().shape({id:u().string.isRequired,label:u().string,name:u().string.isRequired,type:u().string}).isRequired,isActive:u().bool.isRequired,onSelect:u().func.isRequired,onRemove:u().func.isRequired};var De={inputButton:Pe.aJ,inputCheckbox:Pe.E,checkboxGroup:Pe.bl,inputColor:Pe.bv,inputDate:Pe.B,inputDatetimeLocal:Pe.V,inputEmail:Pe.bS,inputFile:Pe._,inputHidden:Pe.aY,radioGroup:Pe.bI,inputText:Pe.ce,select:Pe.b7,textarea:Pe.bw},Be=function(e){var t=e.step,n=e.onUpdateStep,r=e.onAddField,a=e.onRemoveField,i=e.onSelectField,l=e.onReorderFields,o=e.activeFieldId,s=(0,Ie.FR)((0,Ie.MS)(Ie.AN,{activationConstraint:{distance:8}})),u=(0,q.useTranslation)(v).t;return t?d().createElement($.Paper,{className:"fb-step-editor"},d().createElement("div",{className:"fb-step-editor__header"},d().createElement($.Typography,{variant:"heading"},t.label)),d().createElement("div",{className:"fb-step-editor__form"},d().createElement("label",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},u("builder.step.label")),d().createElement($.Input,{value:t.label,onChange:function(e){return n(t.id,{label:e.target.value})}})),d().createElement("label",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},u("builder.step.description")),d().createElement("textarea",{rows:3,className:"fb-textarea",value:t.description,onChange:function(e){return n(t.id,{description:e.target.value})}}))),d().createElement("div",{className:"fb-step-editor__actions"},d().createElement($.Typography,{variant:"subheading"},u("builder.fields.addField")),d().createElement("div",{className:"fb-field-type-grid"},C.filter(function(e){return!e.allowedParents||e.allowedParents.includes("step")}).map(function(e){var n=De[e.id];return d().createElement($.Button,{key:e.id,label:u("fields.types.".concat(e.id)),icon:n?d().createElement(n,{size:"small"}):null,onClick:function(){return r(t.id,e.id)}})}))),d().createElement("div",{className:"fb-step-editor__list"},d().createElement($.Typography,{variant:"subheading"},u("builder.fields.title")),0===t.fields.length&&d().createElement($.Typography,{variant:"body"},u("builder.fields.empty")),t.fields.length>0&&d().createElement(Ie.Mp,{sensors:s,onDragEnd:function(e){var n=e.active,r=e.over;if(r&&n.id!==r.id){var a=t.fields.findIndex(function(e){return e.id===n.id}),i=t.fields.findIndex(function(e){return e.id===r.id});-1!==a&&-1!==i&&l(t.id,(0,Re.be)(t.fields,a,i))}}},d().createElement(Re.gB,{items:t.fields.map(function(e){return e.id}),strategy:Re._G},d().createElement("ul",{className:"fb-field-list"},t.fields.map(function(e){return d().createElement(qe,{key:e.id,field:e,isActive:e.id===o,onSelect:i,onRemove:function(e){return a(t.id,e)}})})))))):d().createElement($.Paper,{className:"fb-step-editor"},d().createElement($.Typography,{variant:"body"},u("builder.step.empty")))};Be.propTypes={step:u().shape({id:u().string.isRequired,label:u().string,description:u().string,fields:u().array}),onUpdateStep:u().func.isRequired,onAddField:u().func.isRequired,onRemoveField:u().func.isRequired,onSelectField:u().func.isRequired,onReorderFields:u().func.isRequired,activeFieldId:u().string},Be.defaultProps={step:null,activeFieldId:null};var Ke=n(557),ze=["className"];function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach(function(t){(0,b.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ve=function(e){var t=e.field,n=e.stepId,r=e.onChangeField,a=e.onAddNestedField,i=(0,q.useTranslation)(v).t,l=$.Textarea||function(e){var t=e.className,n=void 0===t?"":t,r=(0,B.A)(e,ze);return d().createElement("textarea",(0,D.A)({className:"moonstone-textarea ".concat(n).trim()},r))};if(!t)return d().createElement($.Paper,{className:"fb-field-editor"},d().createElement($.Typography,{variant:"body"},i("builder.fields.selectField")));var o=function(e){r(n,t.id,e)},s=function(e,n){o({properties:Me(Me({},t.properties),{},(0,b.A)({},e,n))})},u=C.find(function(e){return e.id===t.type}),p=(null==u?void 0:u.propertySchema)||[],c=[],f=[],m=[],g=!1;p.forEach(function(e){"boolean"===e.type?(c.push(e),g=!0):g?m.push(e):f.push(e)});var h=u?i(u.labelKey):t.type,y=function(e){var n,r=null===(n=t.properties)||void 0===n?void 0:n[e.name],a=i(e.labelKey),o="".concat(t.id,"-").concat(e.name);switch(e.type){case"boolean":return d().createElement("div",{key:o,className:"fb-field fb-field--inline"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Checkbox,{id:"".concat(o,"-checkbox"),checked:Boolean(r),"aria-label":a,onChange:function(t,n,r){return s(e.name,r)}}));case"text":return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Input,{value:r||"",placeholder:e.placeholderKey?i(e.placeholderKey):void 0,onChange:function(t){return s(e.name,t.target.value)}}));case"multiline":return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement(l,{rows:4,value:r||"",onChange:function(t){return s(e.name,t.target.value)}}));case"number":return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Input,{type:"number",value:null==r?"":r,onChange:function(t){var n=""===t.target.value?null:Number(t.target.value);s(e.name,Number.isNaN(n)?null:n)}}));case"date":return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Input,{type:"date",value:r||"",onChange:function(t){return s(e.name,t.target.value||null)}}));case"datetime":return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Input,{type:"datetime-local",value:r||"",onChange:function(t){return s(e.name,t.target.value||null)}}));case"select":var u,p=(e.options||[]).map(function(e){return{value:e.value,label:i(e.labelKey)}}),c=r||e.defaultValue||(null===(u=p[0])||void 0===u?void 0:u.value)||"";return d().createElement("div",{key:o,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},a),d().createElement($.Dropdown,{data:p,value:c,placeholder:i("builder.fields.properties.selectPlaceholder"),onChange:function(t,n){return s(e.name,n.value)}}));case"stringList":return function(e){var n,r=(n=t.properties[e.name],Array.isArray(n)?n:[]),a=e.addLabelKey?i(e.addLabelKey):i("builder.fields.properties.listAdd"),l=e.removeLabelKey?i(e.removeLabelKey):i("builder.fields.properties.listRemove"),o=function(t){return e.itemLabelKey?i(e.itemLabelKey,{index:t}):i("builder.fields.properties.listItem",{index:t})};return d().createElement("div",{key:e.name,className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},i(e.labelKey)),d().createElement("ul",{className:"fb-options"},r.map(function(n,a){var i="".concat(t.id,"-").concat(e.name,"-").concat(a);return d().createElement("li",{key:i,className:"fb-option-row"},d().createElement($.Input,{value:n,placeholder:o(a+1),onChange:function(t){var n=(0,Ke.A)(r);n[a]=t.target.value,s(e.name,n)}}),d().createElement($.Button,{label:l,onClick:function(){var t=r.filter(function(e,t){return t!==a});s(e.name,t)}}))})),d().createElement($.Button,{label:a,onClick:function(){return s(e.name,[].concat((0,Ke.A)(r),[""]))}}))}(e);default:return null}};return d().createElement($.Paper,{className:"fb-field-editor"},d().createElement("div",{className:"fb-field-editor__header"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.editorTitle")),d().createElement($.Typography,{variant:"caption",className:"fb-field-editor__type"},h)),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.label")),d().createElement($.Input,{value:t.label||"",onChange:function(e){var n=e.target.value;o({label:n,properties:Me(Me({},t.properties),{},{"jcr:title":n})})}})),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.name")),d().createElement($.Input,{value:t.name,onChange:function(e){return o({name:e.target.value})}})),f.map(y),c.length>0&&d().createElement("div",{className:"fb-boolean-group"},c.map(y)),m.map(y),function(){if("checkboxGroup"!==t.type)return null;var e=t.fields||[],l=function(e,t){return r(n,e,t)},o=function(t,n){var r=e.find(function(e){return e.id===t}),a=Me(Me({},(null==r?void 0:r.properties)||{}),n);l(t,{properties:a})};return d().createElement("div",{className:"fb-field fb-option-section"},d().createElement("div",{className:"fb-option-section__header"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.checkboxGroup.optionsTitle")),d().createElement($.Button,{color:"accent",label:i("builder.fields.checkboxGroup.addOption"),onClick:function(){var n=e.length+1,r=i("builder.fields.checkboxGroup.optionLabel",{index:n});a({parentPath:t.path,typeId:"inputCheckbox",label:r,properties:{value:"option-".concat(n),defaultChecked:!1}})}})),0===e.length&&d().createElement($.Typography,{variant:"body"},i("builder.fields.checkboxGroup.empty")),e.length>0&&d().createElement("div",{className:"fb-option-card-list"},e.map(function(e,t){var n,r;return d().createElement("div",{key:e.id,className:"fb-option-card"},d().createElement("div",{className:"fb-option-card__header"},d().createElement($.Typography,{variant:"body"},i("builder.fields.checkboxGroup.optionLabel",{index:t+1}))),d().createElement("div",{className:"fb-option-card__grid"},d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionLabelLabel")),d().createElement($.Input,{value:e.label||"",onChange:function(t){return l(e.id,{label:t.target.value})}})),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionValueLabel")),d().createElement($.Input,{value:(null===(n=e.properties)||void 0===n?void 0:n.value)||"",onChange:function(t){return o(e.id,{value:t.target.value})}})),d().createElement("div",{className:"fb-field fb-field--inline"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.properties.defaultChecked")),d().createElement($.Checkbox,{checked:Boolean(null===(r=e.properties)||void 0===r?void 0:r.defaultChecked),onChange:function(t,n,r){return o(e.id,{defaultChecked:r})}}))))})))}(),function(){if("radioGroup"!==t.type)return null;var e=t.fields||[],l=function(e,t){return r(n,e,t)},o=function(t,n){var r=e.find(function(e){return e.id===t}),a=Me(Me({},(null==r?void 0:r.properties)||{}),n);l(t,{properties:a})};return d().createElement("div",{className:"fb-field fb-option-section"},d().createElement("div",{className:"fb-option-section__header"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.radioGroup.optionsTitle")),d().createElement($.Button,{color:"accent",label:i("builder.fields.radioGroup.addOption"),onClick:function(){var n=e.length+1,r=i("builder.fields.radioGroup.optionLabel",{index:n});a({parentPath:t.path,typeId:"inputRadio",label:r,properties:{value:"option-".concat(n),defaultChecked:!1}})}})),0===e.length&&d().createElement($.Typography,{variant:"body"},i("builder.fields.radioGroup.empty")),e.length>0&&d().createElement("div",{className:"fb-option-card-list"},e.map(function(t,n){var r,a;return d().createElement("div",{key:t.id,className:"fb-option-card"},d().createElement("div",{className:"fb-option-card__header"},d().createElement($.Typography,{variant:"body"},i("builder.fields.radioGroup.optionLabel",{index:n+1}))),d().createElement("div",{className:"fb-option-card__grid"},d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionLabelLabel")),d().createElement($.Input,{value:t.label||"",onChange:function(e){return l(t.id,{label:e.target.value})}})),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionValueLabel")),d().createElement($.Input,{value:(null===(r=t.properties)||void 0===r?void 0:r.value)||"",onChange:function(e){return o(t.id,{value:e.target.value})}})),d().createElement("div",{className:"fb-field fb-field--inline"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.properties.defaultChecked")),d().createElement($.Checkbox,{checked:Boolean(null===(a=t.properties)||void 0===a?void 0:a.defaultChecked),onChange:function(n,r,a){return function(t,n){e.forEach(function(e){var r,a=e.id===t,i=Boolean(null===(r=e.properties)||void 0===r?void 0:r.defaultChecked);a?i!==n&&o(e.id,{defaultChecked:n}):n&&i&&o(e.id,{defaultChecked:!1})})}(t.id,a)}}))))})))}(),function(){var e,n;if("select"!==t.type)return null;var r=Array.isArray(null===(e=t.properties)||void 0===e?void 0:e.options)?t.properties.options:[],a=Boolean(null===(n=t.properties)||void 0===n?void 0:n.multiple),l=function(e){return s("options",e)},o=function(e,t){l(r.map(function(n,r){return r===e?Me(Me({},n),t):n}))};return d().createElement("div",{className:"fb-field fb-option-section"},d().createElement("div",{className:"fb-option-section__header"},d().createElement($.Typography,{variant:"subheading"},i("builder.fields.select.optionsTitle")),d().createElement($.Button,{color:"accent",label:i("builder.fields.select.addOption"),onClick:function(){var e=r.length+1;l([].concat((0,Ke.A)(r),[{label:i("builder.fields.select.optionLabel",{index:e}),value:"option-".concat(Date.now()),selected:!1}]))}})),0===r.length&&d().createElement($.Typography,{variant:"body"},i("builder.fields.select.empty")),r.length>0&&d().createElement("div",{className:"fb-option-card-list"},r.map(function(e,t){return d().createElement("div",{key:"select-option-".concat(e.value||t),className:"fb-option-card"},d().createElement("div",{className:"fb-option-card__header"},d().createElement($.Typography,{variant:"body"},i("builder.fields.select.optionLabel",{index:t+1})),d().createElement($.Button,{label:i("builder.fields.properties.listRemove"),onClick:function(){return e=t,void l(r.filter(function(t,n){return n!==e}));var e}})),d().createElement("div",{className:"fb-option-card__grid"},d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionLabelLabel")),d().createElement($.Input,{value:e.label||"",onChange:function(e){return o(t,{label:e.target.value})}})),d().createElement("div",{className:"fb-field"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionValueLabel")),d().createElement($.Input,{value:e.value||"",onChange:function(e){return o(t,{value:e.target.value})}})),d().createElement("div",{className:"fb-field fb-field--inline"},d().createElement($.Typography,{variant:"caption"},i("builder.fields.select.optionSelected")),d().createElement($.Checkbox,{checked:Boolean(e.selected),onChange:function(){return e=t,void l(r.map(function(t,n){return n===e?Me(Me({},t),{},{selected:!t.selected}):a||n===e?t:Me(Me({},t),{},{selected:!1})}));var e}}))))})))}())};Ve.propTypes={field:u().shape({id:u().string.isRequired,label:u().string,name:u().string,path:u().string,type:u().string,properties:u().object,fields:u().array}),stepId:u().string,onChangeField:u().func.isRequired,onAddNestedField:u().func},Ve.defaultProps={field:null,stepId:null,onAddNestedField:function(){}};var Je=n(875),We=function(e,t){var n=(e||[]).find(function(e){return e.name===t});if(n)return n.values&&n.values.length?n.values:n.value},He=function(e){if("string"!=typeof e)return null;var t=e.trim();if(!t)return null;t.endsWith(".")&&(t=t.slice(0,-1));try{return JSON.parse(t)}catch(e){return null}},Ue=function(e){var t,n=null==e||null===(t=e.primaryNodeType)||void 0===t?void 0:t.name,r=function(e){return A(e)}(n),a={},i=(e.children||{}).nodes||[],l=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e.toLowerCase():Boolean(e)};(e.properties||[]).forEach(function(e){if("options"!==e.name){if(e.values&&e.values.length)return"BOOLEAN"===e.type?void(a[e.name]=e.values.map(l)):void(a[e.name]=e.values);"BOOLEAN"!==e.type?a[e.name]=e.value:a[e.name]=l(e.value)}else if(Array.isArray(e.values)&&e.values.length)a[e.name]=e.values.map(function(e){return"string"==typeof e?He(e):e}).filter(Boolean);else if("string"==typeof e.value&&e.value.trim().length){var t=He(e.value);a[e.name]=t?[t]:[]}else e.value&&"object"===(0,Je.A)(e.value)?a[e.name]=[e.value]:a[e.name]=[]});var o=a["jcr:title"]||e.displayName||e.name||"";return o&&(a["jcr:title"]=o),{id:e.uuid,name:e.name,initialName:e.name,path:e.path,label:o,type:r?r.id:n,nodeType:n,properties:a,fields:i.map(Ue)}},Qe=function(e){var t=We(e.properties||[],"jcr:description")||"",n=((e.children||{}).nodes||[]).map(Ue);return{id:e.uuid,name:e.name,initialName:e.name,path:e.path,label:e.displayName||e.name,description:t,fields:n}},Xe=function(e){var t;return"fmdb:fieldset"===(null==e||null===(t=e.primaryNodeType)||void 0===t?void 0:t.name)},Ye=function(e,t){var n,r,i,l=[{name:"jcr:title",value:e.label||e.name||"",language:t,type:"STRING"}],o=(n=e.nodeType||e.type,r=O(n)||A(n),i=new Set,r?((r.propertySchema||[]).forEach(function(e){e&&e.name&&i.add(e.name)}),i):i);return o.add("jcr:title"),o.add("options"),Object.entries(e.properties||{}).forEach(function(e){var n=(0,a.A)(e,2),r=n[0],i=n[1];if("jcr:title"!==r&&o.has(r)&&null!=i)if("options"===r&&Array.isArray(i)){var d=i.map(function(e){if(!e)return null;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(e){return null}}).filter(Boolean);if(!d.length)return;l.push({name:r,values:d,language:t,type:"STRING"})}else if(Array.isArray(i)){if(0===i.length)return;l.push({name:r,values:i,language:t,type:"STRING"})}else if("boolean"==typeof i)l.push({name:r,value:i,type:"BOOLEAN"});else if("string"==typeof i){if(""===i.trim())return;l.push({name:r,value:i,language:t,type:"STRING"})}else l.push({name:r,value:i.toString(),language:t,type:"STRING"})}),l},Ze=function(e,t){var n=[{name:"jcr:title",value:e.label,language:t,type:"STRING"}];return void 0!==e.description&&n.push({name:"jcr:description",value:e.description||"",language:t,type:"STRING"}),n};function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach(function(t){(0,b.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rt=function(){return new Set},at=function(e,t,n){if(null==e)return e;var r=!1,a=e.fields;if(Array.isArray(e.fields)&&e.fields.length){var i=e.fields.map(function(e){var a=at(e,t,n);return a!==e&&(r=!0),a});r&&(a=i)}if(e.id===t){var l=void 0===n.fields?a:n.fields;return nt(nt(nt({},e),n),{},{fields:l})}return r?nt(nt({},e),{},{fields:a}):e},it=function(e,t){if(!e)return{step:null,field:null};var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return et(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){o=!0,i=e},f:function(){try{l||null==n.return||n.return()}finally{if(o)throw i}}}}(e.steps);try{for(r.s();!(n=r.n()).done;)for(var a=n.value,i=(0,Ke.A)(a.fields);i.length>0;){var l=i.shift();if(l.id===t)return{step:a,field:l};l.fields&&l.fields.length&&i.push.apply(i,(0,Ke.A)(l.fields))}}catch(e){r.e(e)}finally{r.f()}return{step:null,field:null}},lt=(n(727),function(e){var t,n,r=e.match,i=(0,q.useTranslation)(v).t,l=(0,p.useHistory)(),s=(0,p.useLocation)(),u=r.params.formId,f=null!=r&&r.url?r.url.replace(/\/[^/]+$/,""):"/form-builder",m=function(e){var t=I(),n=t.workspace,r=t.language,i=t.siteKey,l=(0,o.useState)(r),d=(0,a.A)(l,2),s=d[0],u=d[1],p=(0,o.useState)(null),f=(0,a.A)(p,2),m=f[0],b=f[1],g=(0,o.useState)(!1),h=(0,a.A)(g,2),v=h[0],y=h[1],x=(0,o.useState)(function(){return new Set}),k=(0,a.A)(x,2),E=k[0],w=k[1],S=(0,o.useState)(function(){return new Set}),N=(0,a.A)(S,2),T=N[0],C=N[1],A=(0,o.useState)(!1),O=(0,a.A)(A,2),P=O[0],j=O[1],F=null==e||""===e,$=(0,c.useQuery)(he,{variables:{workspace:n,language:s,uuid:e},fetchPolicy:"no-cache",skip:F}),q=$.data,D=$.loading,B=$.error,K=$.refetch,z=(0,c.useQuery)(ve,{variables:{workspace:n,sitePath:"/sites/".concat(i)}}).data,G=(0,c.useMutation)(xe),M=(0,a.A)(G,1)[0],V=(0,c.useMutation)(Ee),J=(0,a.A)(V,1)[0],W=(0,c.useMutation)(we),H=(0,a.A)(W,1)[0],U=(0,c.useMutation)(Se),Q=(0,a.A)(U,1)[0],X=(0,c.useMutation)(ke),Y=(0,a.A)(X,1)[0],Z=(0,c.useMutation)(Ne),ee=(0,a.A)(Z,1)[0],te=(0,c.useMutation)(Te),ne=(0,a.A)(te,1)[0],re=(0,c.useMutation)(Ce),ae=(0,a.A)(re,1)[0],ie=(0,c.useMutation)(Ae),le=(0,a.A)(ie,1)[0];(0,o.useEffect)(function(){var e;if(console.log("GET_FORM_DETAILS raw response",{data:q,error:B,json:q?JSON.stringify(q):null}),!B&&null!=q&&null!==(e=q.jcr)&&void 0!==e&&e.nodeById){console.log("Loaded form from GraphQL",q.jcr.nodeById);var t=function(e){var t;if(!e)return null;var n=We(e.properties||[],"intro")||"",r=We(e.properties||[],"jcr:title")||e.displayName||e.name,a=((e.children||{}).nodes||[]).filter(Xe),i=(e.fieldsetsContainers||{}).nodes||[],l=i.flatMap(function(e){return((e.children||{}).nodes||[]).filter(Xe)}),o=[].concat((0,Ke.A)(a),(0,Ke.A)(l)),d=(null===(t=i[0])||void 0===t?void 0:t.path)||(a.length>0?e.path:null),s=o.map(Qe);return{id:e.uuid,name:e.name,path:e.path,label:r,intro:n,steps:s,fieldsetsPath:d}}(q.jcr.nodeById);t.label||(t.label=q.jcr.nodeById.displayName||q.jcr.nodeById.name||""),console.log("Normalized form",t),b(t),w(rt()),C(rt()),j(!1)}},[q,B]);var oe=(0,o.useMemo)(function(){var e,t=null==z||null===(e=z.jcr)||void 0===e||null===(e=e.nodeByPath)||void 0===e||null===(e=e.languages)||void 0===e?void 0:e.values;return t&&t.length?t:[r]},[r,z]),de=(0,o.useCallback)(function(e){b(function(t){return t?nt(nt({},t),e):t}),j(!0)},[]),se=(0,o.useCallback)(function(e){w(function(t){var n=new Set(t);return n.add(e),n})},[]),ue=(0,o.useCallback)(function(e){C(function(t){var n=new Set(t);return n.add(e),n})},[]),pe=(0,o.useCallback)((0,R.A)(L().mark(function e(){var t,r,a;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m&&m.path){e.next=1;break}return e.abrupt("return");case 1:return t=m.fieldsetsPath||m.path,r="Step ".concat(m.steps.length+1),a=Oe(r)||"step-".concat(Date.now()),e.next=2,J({variables:{workspace:n,parentPath:t,name:a,language:s,title:r,description:""}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)})),[s,J,m,K,n]),ce=(0,o.useCallback)(function(e,t){b(function(n){if(!n)return n;var r=n.steps.map(function(n){return n.id===e?nt(nt({},n),t):n});return nt(nt({},n),{},{steps:r})}),se(e)},[se]),fe=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t){var r,a;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null==m||null===(r=m.steps)||void 0===r?void 0:r.find(function(e){return e.id===t})){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,Y({variables:{workspace:n,pathOrId:a.path}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[Y,m,K,n]),me=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t){var r;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=1;break}return e.abrupt("return");case 1:return b(function(e){return nt(nt({},e),{},{steps:t})}),r=m.fieldsetsPath||m.path,e.next=2,Q({variables:{workspace:n,pathOrId:r,names:t.map(function(e){return e.name})}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[m,Q,K,n]),be=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t,r){var a,i,l,o;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==m||null===(a=m.steps)||void 0===a?void 0:a.find(function(e){return e.id===t})){e.next=1;break}return e.abrupt("return");case 1:return l=_(r,"Field ".concat(i.fields.length+1)),o=Ye(l,s),e.next=2,ee({variables:{workspace:n,parentPath:i.path,name:Oe(l.label)||"field-".concat(Date.now()),primaryNodeType:l.nodeType,properties:o}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),[s,ee,m,K,n]),ge=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t){var r,a,i,l,o,d,u;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.parentPath,a=t.typeId,i=t.label,l=t.properties,r){e.next=1;break}return e.abrupt("return");case 1:return o=_(a,i||"Field ".concat(Date.now())),d=l?nt(nt({},o),{},{properties:nt(nt({},o.properties),l)}):o,u=Ye(d,s),e.next=2,ee({variables:{workspace:n,parentPath:r,name:Oe(d.label)||"field-".concat(Date.now()),primaryNodeType:d.nodeType,properties:u}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[s,ee,K,n]),ye=(0,o.useCallback)(function(e,t,n){b(function(r){if(!r)return r;var a=r.steps.map(function(r){if(r.id!==e)return r;var a=r.fields.map(function(e){return at(e,t,n)});return nt(nt({},r),{},{fields:a})});return nt(nt({},r),{},{steps:a})}),ue(t)},[ue]),_e=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t,r){var a,i,l,o;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=null==m||null===(a=m.steps)||void 0===a?void 0:a.find(function(e){return e.id===t}),o=null==l||null===(i=l.fields)||void 0===i?void 0:i.find(function(e){return e.id===r})){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,Y({variables:{workspace:n,pathOrId:o.path}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),[Y,m,K,n]),Pe=(0,o.useCallback)(function(){var e=(0,R.A)(L().mark(function e(t,r){var a,i;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==m||null===(a=m.steps)||void 0===a?void 0:a.find(function(e){return e.id===t})){e.next=1;break}return e.abrupt("return");case 1:return b(function(e){if(!e)return e;var n=e.steps.map(function(e){return e.id===t?nt(nt({},e),{},{fields:r}):e});return nt(nt({},e),{},{steps:n})}),e.next=2,ae({variables:{workspace:n,pathOrId:i.path,names:r.map(function(e){return e.name})}});case 2:return e.next=3,K();case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),[m,ae,K,n]),je=(0,o.useCallback)((0,R.A)(L().mark(function e(){var t;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=1;break}return e.abrupt("return");case 1:if(y(!0),e.prev=2,t=[],m.fieldsetsPath||m.path){e.next=3;break}return console.warn("Missing parent path for steps, cannot apply mutations safely"),y(!1),e.abrupt("return");case 3:return P&&t.push(M({variables:{workspace:n,pathOrId:m.path,language:s,title:m.label,intro:m.intro||""}})),E.forEach(function(e){var r=m.steps.find(function(t){return t.id===e});r&&(t.push(H({variables:{workspace:n,pathOrId:r.path,properties:Ze(r,s)}})),r.name!==r.initialName&&t.push(le({variables:{workspace:n,pathOrId:r.path,name:Oe(r.name)||r.name}})))}),T.forEach(function(e){var r=it(m,e),a=r.step,i=r.field;i&&a&&(t.push(ne({variables:{workspace:n,pathOrId:i.path,properties:Ye(i,s)}})),i.name!==i.initialName&&t.push(le({variables:{workspace:n,pathOrId:i.path,name:Oe(i.name)||i.name}})))}),e.next=4,Promise.all(t);case 4:return e.next=5,K();case 5:C(rt()),w(rt()),j(!1);case 6:return e.prev=6,y(!1),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[2,,6,7]])})),[s,T,E,P,m,K,le,ne,M,H,n]);return{form:m,loading:D,saveChanges:je,saving:v,addStep:pe,updateStepState:ce,removeStep:fe,reorderSteps:me,addField:be,addNestedField:ge,updateFieldState:ye,removeField:_e,reorderFields:Pe,activeLanguage:s,setActiveLanguage:u,siteLanguages:oe,updateFormState:de}}(u),b=m.form,g=m.loading,h=m.addStep,y=m.updateStepState,x=m.removeStep,k=m.reorderSteps,E=m.addField,w=m.addNestedField,S=m.updateFieldState,N=m.removeField,T=m.reorderFields,C=m.saveChanges,A=m.saving,O=(0,o.useState)(null),P=(0,a.A)(O,2),j=P[0],F=P[1],D=(0,o.useState)(null),B=(0,a.A)(D,2),K=B[0],z=B[1];(0,o.useEffect)(function(){b&&0!==b.steps.length?j&&b.steps.some(function(e){return e.id===j})||F(b.steps[0].id):F(null)},[b,j]);var G=(0,o.useMemo)(function(){var e;return null==b||null===(e=b.steps)||void 0===e?void 0:e.find(function(e){return e.id===j})},[b,j]);(0,o.useEffect)(function(){G?K&&G.fields.find(function(e){return e.id===K})||(G.fields.length>0?z(G.fields[0].id):z(null)):z(null)},[K,G]);var M=(null==G||null===(t=G.fields)||void 0===t?void 0:t.find(function(e){return e.id===K}))||null,V=function(){var e=(0,R.A)(L().mark(function e(t){var n;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=b.steps.find(function(e){return e.id===t})){e.next=1;break}return e.abrupt("return");case 1:if(window.confirm(i("builder.sidebar.removeConfirm",{title:n.label}))){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,x(t);case 3:z(null);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=(0,R.A)(L().mark(function e(t,n){var r,a;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.steps.find(function(e){return e.id===t}),a=null==r?void 0:r.fields.find(function(e){return e.id===n})){e.next=1;break}return e.abrupt("return");case 1:if(window.confirm(i("builder.fields.removeConfirm",{title:a.label||a.name}))){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,N(t,n);case 3:z(null);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),W=(null===(n=s.state)||void 0===n?void 0:n.formTitle)||"",H=(null==b?void 0:b.label)||(null==b?void 0:b.name)||W,U=i("accordionTitle"),Q=H?"".concat(U," - ").concat(H):U;(0,o.useEffect)(function(){console.log("FormBuilder route context",{match:r,location:s,formId:u})},[s,r,u]),(0,o.useEffect)(function(){console.log("FormBuilder header data",{loading:g,formLabel:null==b?void 0:b.label,formName:null==b?void 0:b.name,initialTitle:W,currentLabel:H,headerTitle:Q})},[g,b,W,H,Q]);var X=d().createElement("button",{type:"button",className:"fb-back-button",onClick:function(){return l.push(f)}},d().createElement(Pe.Q,{size:"big"})),Y=d().createElement($.Button,{key:"save",color:"accent",size:"big",label:i(A?"actions.saving":"actions.save"),isDisabled:A||!b,onClick:C});return d().createElement($.LayoutContent,{header:d().createElement($.Header,{title:Q,subtitle:i("list.subtitle"),backButton:X,mainActions:[Y]}),content:g||!b?d().createElement("div",{className:"fb-loading"},d().createElement($.Loader,{size:"big"}),d().createElement($.Typography,{variant:"body"},i("states.loading"))):d().createElement("div",{className:"fb-builder__wrapper"},d().createElement("div",{className:"fb-builder__content"},d().createElement($e,{steps:b.steps,activeStepId:j,onSelectStep:F,onAddStep:h,onRemoveStep:V,onReorderSteps:function(e){return k(e)}}),d().createElement("div",{className:"fb-builder__main"},d().createElement(Be,{step:G,activeFieldId:K,onUpdateStep:function(e,t){return y(e,t)},onAddField:E,onRemoveField:J,onSelectField:z,onReorderFields:function(e,t){return T(e,t)}})),d().createElement("div",{className:"fb-builder__side"},d().createElement(Ve,{field:M,stepId:null==G?void 0:G.id,onChangeField:S,onAddNestedField:w}))))})});lt.propTypes={match:u().shape({params:u().shape({formId:u().string}).isRequired,path:u().string,url:u().string}).isRequired},u().string.isRequired,u().string.isRequired,u().func.isRequired;var ot=m(),dt=function(e){var t=e.match,n=((null==t?void 0:t.path)||"/form-builder").replace(/\*$/,"");return d().createElement(c.ApolloProvider,{client:ot},d().createElement(j,null,d().createElement(p.Switch,null,d().createElement(p.Route,{exact:!0,path:n,component:je}),d().createElement(p.Route,{path:"".concat(n,"/:formId"),component:lt}),d().createElement(p.Redirect,{to:n}))))};dt.propTypes={match:u().shape({path:u().string})},dt.defaultProps={match:{path:"/form-builder"}};var st=(0,p.withRouter)(dt),ut=function(e){var t=e.match;return d().createElement(st,{match:t})};ut.propTypes={match:u().object},ut.defaultProps={match:null};var pt=function(e){var t=e.width,n=e.height;return d().createElement("svg",{width:t,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d().createElement("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3",stroke:"#2681ff",strokeWidth:"1.8"}),d().createElement("rect",{x:"6",y:"7",width:"12",height:"2",fill:"#2681ff"}),d().createElement("rect",{x:"6",y:"11",width:"8",height:"2",fill:"#2681ff",opacity:"0.6"}),d().createElement("rect",{x:"6",y:"15",width:"10",height:"2",fill:"#2681ff",opacity:"0.4"}),d().createElement("circle",{cx:"17",cy:"12",r:"2",stroke:"#2681ff",strokeWidth:"1.5"}))};pt.propTypes={width:u().number,height:u().number},pt.defaultProps={width:24,height:24};var ct=function(){window.jahia&&window.jahia.i18n&&window.jahia.i18n.loadNamespaces&&window.jahia.i18n.loadNamespaces(v),r.registry.add("accordionItem","formBuilderAccordion",r.registry.get("accordionItem","renderDefaultApps"),{targets:["jcontent:75"],icon:d().createElement(pt,{width:24,height:24}),label:"".concat(v,":accordionTitle"),defaultPath:i,appsTarget:"formBuilderAccordionApps"}),r.registry.add("adminRoute","formidableBuilder",{targets:["formBuilderAccordionApps"],icon:d().createElement(pt,null),label:"".concat(v,":label"),path:"".concat(i,"*"),defaultPath:i,isSelectable:!0,requireModuleInstalledOnSite:"formidable",render:function(e){return d().createElement(o.Suspense,{fallback:"loading ..."},d().createElement(ut,{match:e.match}))}}),console.debug("%c form-builder module is activated","color: #3c8cba")},ft=n(793),mt=n.n(ft);const bt=JSON.parse('{"formidableBuilder":{"label":"Form Builder","accordionTitle":"Forms","states":{"loading":"Loading form data..."},"actions":{"create":"Create form","creating":"Creating...","cancel":"Cancel","edit":"Edit","delete":"Delete","duplicate":"Duplicate","preview":"Preview","submissions":"Submissions","settings":"Form settings","refresh":"Refresh","back":"Back to list","save":"Save changes","saving":"Saving..."},"list":{"title":"All forms","subtitle":"Manage Formidable forms directly from JContent.","empty":"No forms available yet.","create":{"title":"Create a new form","description":"Provide a title and optional introduction for the new form."},"fields":{"title":"Title","titlePlaceholder":"Ex: Contact form","intro":"Introduction","introPlaceholder":"Tell authors what this form is about"},"columns":{"title":"Form title","steps":"Steps","intro":"Introduction","actions":"Actions","stepCount":"{{count}} step(s)","noIntro":"No introduction"},"actions":{"deleteConfirm":"Delete form \\"{{title}}\\"?"},"cards":{"updated":"Last updated","neverUpdated":"Never updated","duplicateName":"{{title}} (Copy)","introFallback":"No description provided"}},"builder":{"form":{"title":"Form title","intro":"Introduction"},"sidebar":{"title":"Steps","addStep":"Add step","removeStep":"Remove","removeConfirm":"Delete step \\"{{title}}\\"?"},"step":{"empty":"Select a step to start editing.","label":"Step label","description":"Step description"},"fields":{"title":"Fields","addField":"Add a field","empty":"No fields yet.","remove":"Remove","removeConfirm":"Delete field \\"{{title}}\\"?","selectField":"Select a field to edit its properties.","editorTitle":"Field settings","label":"Field label","name":"Field name","properties":{"buttonType":"Button action","buttonTypeOptions":{"button":"Button","submit":"Submit","reset":"Reset"},"variant":"Variant","variantOptions":{"primary":"Primary","secondary":"Secondary","danger":"Danger"},"required":"Required","defaultChecked":"Checked by default","value":"Value","placeholder":"Placeholder","defaultValue":"Default value","defaultDate":"Default date","minDate":"Minimum date","maxDate":"Maximum date","defaultDateTime":"Default date & time","minDateTime":"Minimum date & time","maxDateTime":"Maximum date & time","step":"Step","list":"Data list values","listAdd":"Add value","listRemove":"Remove value","listItem":"Value {{index}}","pattern":"Pattern","minLength":"Minimum length","maxLength":"Maximum length","autocomplete":"Autocomplete","multiple":"Allow multiple values","options":"Options","optionsAdd":"Add option","optionsRemove":"Remove option","optionsItem":"Option {{index}}","size":"Visible options","disabled":"Disabled","autofocus":"Auto focus","accept":"Accepted MIME types","rows":"Rows","resize":"Resize behaviour","resizeOptions":{"none":"None","both":"Both","horizontal":"Horizontal","vertical":"Vertical"},"selectPlaceholder":"Select an option"},"radioGroup":{"optionsTitle":"Radio options","empty":"No radio options yet.","addOption":"Add radio option","optionLabel":"Option {{index}}"},"checkboxGroup":{"optionsTitle":"Checkbox options","empty":"No checkbox options yet.","addOption":"Add checkbox","optionLabel":"Option {{index}}"},"select":{"optionsTitle":"Select options","empty":"No select options yet.","addOption":"Add select option","optionValueLabel":"Value","optionLabelLabel":"Label","optionSelected":"Selected","optionLabel":"Option {{index}}"},"selectOption":{"optionsTitle":"Select options","empty":"No options yet.","addOption":"Add select option","optionValueLabel":"Value","optionLabelLabel":"Label","optionSelected":"Selected","optionLabel":"Option {{index}}"}},"preview":{"title":"JSON preview"}},"fields":{"types":{"inputButton":"Button","inputCheckbox":"Checkbox","checkboxGroup":"Checkbox group","inputColor":"Color","inputDate":"Date","inputDatetimeLocal":"Date/time","inputEmail":"Email","inputFile":"File upload","inputHidden":"Hidden","inputRadio":"Radio option","radioGroup":"Radio group","inputText":"Text","select":"Select","textarea":"Textarea"}}}}'),gt=JSON.parse('{"formidableBuilder":{"label":"Constructeur de formulaires","accordionTitle":"Formulaires","states":{"loading":"Chargement des formulaires..."},"actions":{"create":"Crer un formulaire","creating":"Cration...","cancel":"Annuler","edit":"Modifier","delete":"Supprimer","duplicate":"Dupliquer","preview":"Prvisualiser","submissions":"Soumissions","settings":"Paramtres","refresh":"Actualiser","back":"Retour  la liste","save":"Enregistrer","saving":"Enregistrement..."},"list":{"title":"Tous les formulaires","subtitle":"Grez les formulaires Formidable depuis JContent.","empty":"Aucun formulaire pour l\'instant.","create":{"title":"Nouveau formulaire","description":"Saisissez un titre et une introduction optionnelle."},"fields":{"title":"Titre","titlePlaceholder":"Ex : Formulaire de contact","intro":"Introduction","introPlaceholder":"Expliquez lobjectif de ce formulaire"},"columns":{"title":"Titre","steps":"tapes","intro":"Introduction","actions":"Actions","stepCount":"{{count}} tape(s)","noIntro":"Sans introduction"},"actions":{"deleteConfirm":"Supprimer le formulaire {{title}} ?"},"cards":{"updated":"Dernire mise  jour","neverUpdated":"Jamais mis  jour","duplicateName":"{{title}} (Copie)","introFallback":"Aucune description"}},"builder":{"form":{"title":"Titre du formulaire","intro":"Introduction"},"sidebar":{"title":"tapes","addStep":"Ajouter une tape","removeStep":"Supprimer","removeConfirm":"Supprimer l\'tape {{title}} ?"},"step":{"empty":"Slectionnez une tape pour commencer.","label":"Libell de l\'tape","description":"Description"},"fields":{"title":"Champs","addField":"Ajouter un champ","empty":"Aucun champ pour cette tape.","remove":"Supprimer","removeConfirm":"Supprimer le champ {{title}} ?","selectField":"Slectionnez un champ pour modifier ses proprits.","editorTitle":"Paramtres du champ","label":"Libell","name":"Nom technique","properties":{"buttonType":"Action du bouton","buttonTypeOptions":{"button":"Bouton","submit":"Soumettre","reset":"Rinitialiser"},"variant":"Variante","variantOptions":{"primary":"Primaire","secondary":"Secondaire","danger":"Danger"},"required":"Obligatoire","defaultChecked":"Coch par dfaut","value":"Valeur","placeholder":"Placeholder","defaultValue":"Valeur par dfaut","defaultDate":"Date par dfaut","minDate":"Date minimum","maxDate":"Date maximum","defaultDateTime":"Date & heure par dfaut","minDateTime":"Date & heure minimum","maxDateTime":"Date & heure maximum","step":"Pas","list":"Valeurs de la liste de donnes","listAdd":"Ajouter une valeur","listRemove":"Supprimer la valeur","listItem":"Valeur {{index}}","pattern":"Pattern","minLength":"Longueur minimale","maxLength":"Longueur maximale","autocomplete":"Autocompltion","multiple":"Autoriser plusieurs valeurs","options":"Options","optionsAdd":"Ajouter une option","optionsRemove":"Supprimer loption","optionsItem":"Option {{index}}","size":"Options visibles","disabled":"Dsactiv","autofocus":"Focus automatique","accept":"Types MIME accepts","rows":"Lignes","resize":"Comportement du redimensionnement","resizeOptions":{"none":"Aucun","both":"Les deux","horizontal":"Horizontal","vertical":"Vertical"},"selectPlaceholder":"Slectionner une option"},"radioGroup":{"optionsTitle":"Options radio","empty":"Aucune option pour le moment.","addOption":"Ajouter une option radio","optionLabel":"Option {{index}}"},"checkboxGroup":{"optionsTitle":"Options de cases  cocher","empty":"Aucune case pour le moment.","addOption":"Ajouter une case","optionLabel":"Option {{index}}"},"select":{"optionsTitle":"Options de liste","empty":"Aucune option pour le moment.","addOption":"Ajouter une option","optionValueLabel":"Valeur","optionLabelLabel":"Label","optionSelected":"Slectionne","optionLabel":"Option {{index}}"}},"preview":{"title":"Aperu JSON"}},"fields":{"types":{"inputButton":"Bouton","inputCheckbox":"Case  cocher","checkboxGroup":"Groupe de cases","inputColor":"Couleur","inputDate":"Date","inputDatetimeLocal":"Date/heure","inputEmail":"E-mail","inputFile":"Fichier","inputHidden":"Cach","inputRadio":"Option radio","radioGroup":"Groupe radio","inputText":"Texte","select":"Liste","textarea":"Zone de texte"}}}}');var ht=function(){[["en",bt],["fr",gt]].forEach(function(e){var t=(0,a.A)(e,2),n=t[0],r=t[1][v];r&&!mt().hasResourceBundle(n,v)&&mt().addResourceBundle(n,v,r,!0,!0)})};function vt(){ht(),ct()}function yt(){r.registry.add("callback","formidableBuilder",{targets:["jahiaApp-init:2"],callback:vt})}},727:(e,t,n)=>{var r=n(72),a=n(400);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.id,a,""]]);r(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}}}]);
//# sourceMappingURL=624.jahia.e51eaa.js.map